<html>
<head>
    <title></title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/ui-lightness/jquery-ui.css">
    <script src="../closure-library/closure/goog/base.js"></script>
    <script src="geometry.js"></script>
    <script src="voronoi.js"></script>
    <script src="interaction.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            // Initialize system
            var sys = new VoronoiSystem($("#plane"), $("#slider"));
            sys.addHandlers();

            // Basic test input
            sys.addPoint(-2,0);
            sys.addPoint(-1.5,0.4);
            sys.addPoint(-1,1);
            sys.addPoint(-0.5,1.4);
            sys.addPoint(0,-1);
            sys.addPoint(1,-2);
            sys.addPoint(2,2);
            sys.fitBounds();

            // Update screen bounds
            var b = sys.bounds();
            $("#xmin").get(0).value = b[0];
            $("#ymin").get(0).value = b[1];
            $("#xmax").get(0).value = b[2];
            $("#ymax").get(0).value = b[3];

            sys.update();

            // Set click handlers
            $("#rand").click(function(e){
                var n = parseInt($("#numpts").get(0).value);
                if (n < 2) return;
                sys.randomPoints(n);
                sys.resize();
                sys.fitBounds();
                var b = sys.bounds();
                $("#xmin").get(0).value = b[0];
                $("#ymin").get(0).value = b[1];
                $("#xmax").get(0).value = b[2];
                $("#ymax").get(0).value = b[3];
                sys.update();
                sys.voronoi();
            });
            $("#step").click(function(e){
                sys.step();
            });
            $("#complete").click(function(e){
                sys.complete();
            });
            $("#restart").click(function(e){
                sys.voronoi();
                var b = [];
                b[0] = $("#xmin").get(0).value;
                b[1] = $("#ymin").get(0).value;
                b[2] = $("#xmax").get(0).value;
                b[3] = $("#ymax").get(0).value;
                sys.bounds(b);
                sys.update();
            });
            $("#updatebounds").click(function(e){
                var b = [];
                b[0] = $("#xmin").get(0).value;
                b[1] = $("#ymin").get(0).value;
                b[2] = $("#xmax").get(0).value;
                b[3] = $("#ymax").get(0).value;
                sys.bounds(b);
                sys.update();
            });

            // Animation
            var animated = false;
            var timeout = false;
            var t = 50;
            var dostep = function() {
                var v = $("#slider").slider("value");
                var s = $("#slider").slider("option", "step");
                if (v == $("#slider").slider("option", "max")) {
                    $("#animate").get(0).value = "Animate sweep line";
                    clearTimeout(timeout);
                    animated = false;
                    return false;
                }
                sys.slide(v+s);
                timeout = setTimeout(dostep, t);
                animated = true;
                return true;
            };
            $("#animate").click(function(e){
                if (animated) {
                    $("#animate").get(0).value = "Animate sweep line";
                    clearTimeout(timeout);
                    animated = !animated;
                }
                else {
                    if (dostep()) {
                        $("#animate").get(0).value = "Stop sweep line animation";
                    }
                }
            });

            // Initialize slider
            $("#slider").slider({
                min:0,
                max:200,
            });
            $("#slider").bind("slide", function(e, ui) {
                if (animated) $("#animate").click();
                sys.slide(ui.value);
            });
        });
    </script>
</head>
<body>
    <table><tr>
        <td>
            Xmin: <input id="xmin" size=2> Xmax: <input id="xmax" size=2>
            Ymin: <input id="ymin" size=2> Ymax: <input id="ymax" size=2><input type="button" id="updatebounds" value = "Update Bounds"><br>
            <div>
                <canvas id="plane" width="640px" height="480px" style="border: 1px solid black;"></canvas><br>
                <div style="padding:10px 0px">
                    <div id="slider"></div>
                </div>
            </div>
        </td>
        <td valign="top">
            <input id="numpts" value="10" size=2></input><input id="rand" type="button" value="Generate Random Points"><br>
            <input type="button" id="step" value="Next event">
            <input type="button" id="animate" value="Animate sweep line">
            <br>
            <input type="button" id="complete" value="Compute Voronoi Diagram">
            <input type="button" id="restart" value="Restart"><br>
            <textarea id="evtq" rows="12" cols="80"></textarea><br>
            <textarea id="beach" rows="10" cols="80"></textarea><br>
        </td>
    </tr></table>
</body>
</html>
